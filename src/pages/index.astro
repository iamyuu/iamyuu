---
import { Image } from 'astro:assets';

import Layout from '@/layouts/Layout.astro';
import SocialLinks from '@/components/SocialLinks.astro';
import PostCard from '@/components/PostCard.astro';
import ProjectCard from '@/components/ProjectCard.astro';
import Link from '@/components/shared/Link.astro';
import convertAsteriskToStrongTag from '@/utils/convertAsteriskToStrongTag';

import presentation from '@/constants/presentation';
import { getAllPost, getAllProject } from '@/utils/data';

const posts = await getAllPost();
const projects = await getAllProject();

export const prerender = true;
---

<Layout>
	<main class='flex flex-col space-y-20'>
		<article class='flex flex-col space-y-8 md:flex-row-reverse md:justify-end md:gap-12'>
			{presentation.profile ? <Image src={presentation.profile} class='w-1/4 self-center rounded-full' alt='Your Profile' width='200' height='200' /> : null}

			<div class='flex flex-col space-y-8'>
				<h1 class='text-3xl text-neutral-100'>
					{presentation.title}
				</h1>

				<h2 class='w-auto max-w-[60ch] leading-6' set:html={convertAsteriskToStrongTag(presentation.description)} />

				<SocialLinks />
			</div>
		</article>

		<article class='flex flex-col space-y-8'>
			<header class='flex w-full flex-row justify-between gap-2'>
				<h3 class='text-lg text-neutral-100'>Latest posts</h3>
				{posts.length > 0 ? <Link href='/posts' label='See all posts' isUnderline target='_self' /> : null}
			</header>

			{
				posts.length > 0 ? (
					<section class='grid gap-4 grid-cols-auto-fit-4'>
						{posts.slice(0, 2).map(post => (
							<PostCard publishedAt={post.data.publishedAt} title={post.data.title} description={post.data.description} slug={post.slug} />
						))}
					</section>
				) : (
					<p>Soon, stay connected ðŸ‘€...</p>
				)
			}
		</article>

		<article class='flex flex-col space-y-8'>
			<header class='flex w-full flex-row justify-between gap-2'>
				<h3 class='text-lg text-neutral-100'>
					Selected projects ({projects.length})
				</h3>
			</header>

			<section class='flex flex-col space-y-4'>
				{
					projects.map(({ data: project }) => {
						if (project.isComingSoon) {
							return <ProjectCard {...project} />;
						}

						return (
							<a href={project.link} target='_blank' rel='noreferrer'>
								<ProjectCard {...project} />
							</a>
						);
					})
				}
			</section>
		</article>

		<article class='flex flex-col space-y-8'>
			<header class='flex w-full flex-row justify-between gap-2'>
				<h3 class='text-lg text-neutral-100'>Get in touch</h3>
			</header>
			<p>
				Email me at <Link href={`mailto:${presentation.mail}`} label={presentation.mail} /> or follow me via my social links.
			</p>

			<SocialLinks />
		</article>
	</main>
</Layout>
